<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/>
    <link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/>
    <title>AccountTab.kt</title>
    <link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/>
    <script type="text/javascript" src="../jacoco-resources/prettify.js"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html"
                                                              class="el_session">Sessions</a></span><a
        href="../index.html" class="el_report">schwab-trader</a> &gt; <a href="index.source.html" class="el_package">com.droidkfx.st.view</a>
    &gt; <span class="el_source">AccountTab.kt</span></div>
<h1>AccountTab.kt</h1>
<pre class="source lang-java linenums">package com.droidkfx.st.view

import com.droidkfx.st.controller.AllocationTable
import com.droidkfx.st.strategy.StrategyAction
import com.droidkfx.st.util.databind.mapped
import com.droidkfx.st.view.model.AccountTabViewModel
import io.github.oshai.kotlinlogging.KotlinLogging.logger
import java.awt.BorderLayout
import java.awt.FlowLayout
import java.awt.event.FocusListener
import javax.swing.JButton
import javax.swing.JLabel
import javax.swing.JPanel
import javax.swing.JTextField
import javax.swing.SwingUtilities

<span class="nc" id="L17">abstract class AccountTab(</span>
    viewModel: AccountTabViewModel,
<span class="nc" id="L19">) : JPanel(BorderLayout()) {</span>
<span class="nc" id="L20">    private val logger = logger {}</span>

<span class="nc" id="L22">    init {</span>
<span class="nc" id="L23">        logger.trace { &quot;Initializing&quot; }</span>
<span class="nc" id="L24">        val saveAllocationsButton = JButton(&quot;Save Allocations&quot;).apply {</span>
<span class="nc" id="L25">            isEnabled = false</span>
<span class="nc" id="L26">            addCoActionListener {</span>
<span class="nc" id="L27">                saveAccountPositions()</span>
<span class="nc" id="L28">                SwingUtilities.invokeLater { isEnabled = false }</span>
<span class="nc" id="L29">            }</span>
<span class="nc"
      id="L30">            viewModel.data.mapped { it.symbol to it.allocationTarget }.addSwingListener {</span>
<span class="nc" id="L31">                isEnabled = true</span>
<span class="nc" id="L32">            }</span>
<span class="nc" id="L33">        }</span>
<span class="nc" id="L34">        val allocationTable = AllocationTable(viewModel.data).apply {</span>
<span class="nc" id="L35">            addTableModelListener {</span>
<span class="nc" id="L36">                saveAllocationsButton.isEnabled = true</span>
<span class="nc" id="L37">            }</span>
<span class="nc" id="L38">        }</span>

<span class="nc" id="L40">        add(</span>
<span class="nc" id="L41">            JPanel(</span>
<span class="nc" id="L42">                FlowLayout().apply { alignment = FlowLayout.LEFT }).apply {</span>
<span class="nc" id="L43">                add(JTextField(viewModel.accountNameDataBinding.value).apply {</span>
                    // enter key
<span class="nc" id="L45">                    addActionListener {</span>
<span class="nc" id="L46">                        logger.debug { &quot;Account name changed to $text&quot; }</span>
<span class="nc" id="L47">                        viewModel.setAccountName(text)</span>
<span class="nc" id="L48">                    }</span>
<span class="nc" id="L49">                    addFocusListener(</span>
<span class="nc" id="L50">                        object : FocusListener {</span>
                            override fun focusLost(e: java.awt.event.FocusEvent?) {
<span class="nc"
      id="L52">                                logger.debug { &quot;Account name changed to $text&quot; }</span>
<span class="nc" id="L53">                                viewModel.setAccountName(text)</span>
<span class="nc" id="L54">                            }</span>

<span class="nc" id="L56">                            override fun focusGained(e: java.awt.event.FocusEvent?) {}</span>
                        }
                    )
<span class="nc" id="L59">                })</span>
<span class="nc" id="L60">                add(saveAllocationsButton)</span>
<span class="nc" id="L61">                val processOrdersButton = JButton(&quot;Process Orders&quot;).apply {</span>
<span class="nc" id="L62">                    isEnabled = false</span>
<span class="nc" id="L63">                    addCoActionListener {</span>
<span class="nc" id="L64">                        processOrders()</span>
<span class="nc" id="L65">                    }</span>
<span class="nc" id="L66">                    addActionListener { isEnabled = false }</span>
<span class="nc" id="L67">                }</span>
<span class="nc" id="L68">                add(JButton(&quot;Refresh Data&quot;).apply {</span>
<span class="nc" id="L69">                    addCoActionListener {</span>
<span class="nc" id="L70">                        refreshData()</span>
<span class="nc" id="L71">                        SwingUtilities.invokeLater {</span>
<span class="nc" id="L72">                            processOrdersButton.isEnabled = viewModel.data.any {</span>
<span class="nc bnc" id="L73" title="All 4 branches missed.">                                it.tradeAction == StrategyAction.BUY.name || it.tradeAction == StrategyAction.SELL.name</span>
                            }
//                            allocationTable.notifyDataChanged()
<span class="nc" id="L76">                        }</span>
<span class="nc" id="L77">                    }</span>
<span class="nc" id="L78">                })</span>
<span class="nc" id="L79">                add(processOrdersButton)</span>
<span class="nc" id="L80">                add(JLabel(&quot;Account Cash: $ ${&quot;%.2f&quot;.format(viewModel.accountCash.value)}&quot;).apply {</span>
<span class="nc" id="L81">                    viewModel.accountCash.addSwingListener { text = &quot;Account Cash: $ ${&quot;%.2f&quot;.format(it)}&quot; }</span>
<span class="nc" id="L82">                })</span>
<span class="nc" id="L83">            }, BorderLayout.NORTH</span>
        )
<span class="nc" id="L85">        add(allocationTable, BorderLayout.CENTER)</span>
<span class="nc" id="L86">    }</span>

    abstract suspend fun saveAccountPositions()
    abstract suspend fun refreshData()
    abstract suspend fun processOrders()
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span>
</div>
</body>
</html>